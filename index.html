<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>çƒŸé›¨æ±Ÿæ¹– - è£…å¤‡å½•å…¥å·¥å…· V35</title>
    <style>
        :root {
            --bg: #0f0f0f; --card: #1a1a1a; --text: #e0e0e0; --border: #2a2a2a;
            --green: #2ecc71; --blue: #3498db; --purple: #9b59b6; --accent: #f1c40f; --special: #bf00ff;
            --btn-idle: #252525; --nav-text: #888; --title-color: #ffffff;
            --zebra: rgba(255,255,255,0.02);
        }
        [data-theme="light"] {
            --bg: #f5f6fa; --card: #ffffff; --text: #2f3542; --border: #dcdde1;
            --btn-idle: #f1f2f6; --nav-text: #636e72; --title-color: #000000;
            --zebra: rgba(0,0,0,0.02);
        }

        body { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; transition: 0.3s; }
        
        /* V30 æ ·å¼æ‚¬æµ®é¢æ¿ */
        .control-panel { position: fixed; top: 15px; right: 15px; display: flex; background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 30px; padding: 4px 8px; z-index: 1000; }
        [data-theme="light"] .control-panel { background: rgba(255,255,255,0.8); }
        .ctrl-btn { background: transparent; color: var(--nav-text); border: none; padding: 6px 12px; font-size: 13px; cursor: pointer; border-radius: 20px; transition: 0.2s; }
        .ctrl-btn:hover { color: var(--blue); }

        .top-container { display: flex; align-items: center; background: var(--card); padding: 18px 25px; border-radius: 16px; margin-bottom: 20px; border: 1px solid var(--border); gap: 25px; }
        .logo-img { height: 45px; }
        
        /* ä¼˜åŒ–ï¼šå¢åŠ æ–‡å­—ä¸æŒ‰é’®çš„é—´è· */
        .nav-label { font-size: 12px; color: var(--nav-text); width: 50px; font-weight: bold; margin-right: 15px; display: inline-block; }
        .btn-type { background: var(--btn-idle); color: var(--nav-text); padding: 6px 14px; font-size: 13px; border: 1px solid var(--border); margin-right: 8px; cursor: pointer; border-radius: 8px; font-weight: bold; }
        .btn-type.active { background: var(--blue); color: white; border-color: var(--blue); }

        .loc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .loc-section { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid var(--border); }
        .loc-title { font-size: 1.15em; font-weight: bold; color: var(--title-color); margin-bottom: 20px; text-align: center; }
        
        .control-head { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 20px; }
        .equip-ctrl { flex: 1; background: var(--btn-idle); padding: 12px; border-radius: 12px; border: 1px solid var(--border); }
        .ename { font-size: 14px; color: var(--title-color); font-weight: bold; margin-bottom: 10px; display: block; text-align: center; }
        .btn-group { display: flex; gap: 6px; }
        .btn-q { flex: 1; padding: 10px 0; font-size: 12px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .bg-g { background-color: var(--green); } .bg-b { background-color: var(--blue); } .bg-p { background-color: var(--purple); }

        .table-wrapper { height: 500px; overflow-y: auto; background: var(--card); border-radius: 12px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
        
        tbody tr:nth-child(even) { background-color: var(--zebra); }
        tbody tr { border-bottom: 1px solid var(--border); }
        
        th { background: var(--btn-idle); padding: 12px; font-size: 11px; color: var(--nav-text); border-bottom: 2px solid var(--border); position: sticky; top: 0; z-index: 10; }
        .td-idx { font-size: 11px; color: var(--nav-text); background: var(--btn-idle) !important; width: 35px; text-align: center; border-right: 1px solid var(--border); }
        .v-line { width: 2px; background: var(--border); }

        .cell-container { display: flex; align-items: stretch; height: 100%; min-height: 65px; }
        .data-main { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 6px; }
        .op-right-zone { display: flex; width: 60px; border-left: 1px solid var(--border); }
        .op-btn { flex: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .op-keep { font-size: 14px; color: #444; border-right: 1px solid var(--border); }
        .op-keep.active { color: var(--accent); }
        .op-del { font-size: 11px; color: #444; }
        .op-del:hover { background: rgba(255, 71, 87, 0.1); color: #ff4757; }

        .attr-tag { font-size: 10px; background: rgba(52, 152, 219, 0.08); border: 1px solid var(--blue); border-radius: 4px; padding: 1px 5px; color: var(--blue); margin: 2px; }
        .special-tag { font-size: 10px; background: rgba(191, 0, 255, 0.08); border: 1px solid var(--special); border-radius: 4px; padding: 1px 5px; color: var(--special); font-weight: bold; margin: 2px; }
        .col-keep { background: rgba(241, 196, 15, 0.15) !important; }

        .modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:var(--card); border:1px solid var(--border); border-radius:20px; padding:25px; z-index:1001; box-shadow:0 20px 60px rgba(0,0,0,0.5); width:360px; }
        .modal-label { font-size: 12px; color: var(--nav-text); margin-bottom: 10px; margin-top: 15px; display: flex; justify-content: space-between; }
        .mask { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:900; backdrop-filter: blur(4px); }
    </style>
</head>
<body data-theme="dark">

<div class="control-panel">
    <button class="ctrl-btn" onclick="showHelp()">ğŸ’¡ å¸®åŠ©</button>
    <button class="ctrl-btn" id="themeToggle" onclick="toggleTheme()">ğŸŒ™ æ¨¡å¼</button>
    <button class="ctrl-btn" onclick="exportData()">ğŸ“¤ å¤‡ä»½</button>
    <button class="ctrl-btn" onclick="importData()">ğŸ“¥ è¿˜åŸ</button>
    <button class="ctrl-btn" onclick="clearCurrent()" style="color:#ff4757">ğŸ—‘ï¸ æ¸…ç©º</button>
</div>

<div class="top-container">
    <img src="https://patchwiki.biligame.com/resources/assets/images/logo/logo_yanyu.png?t=2026021722&v=76" class="logo-img">
    <div class="nav-area">
        <div id="forgeNav" style="margin-bottom:10px;"></div>
        <div id="sewNav"></div>
    </div>
</div>

<input type="file" id="fileInput" style="display:none">
<div class="loc-grid" id="mainGrid"></div>

<div class="mask" id="mask" onclick="closeAllModals()"></div>

<div class="modal" id="attrPicker">
    <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:var(--title-color);">å½•å…¥åºåˆ—</div>
    <div class="modal-label"><span>åŸºç¡€è¯æ¡</span><span id="limitLabel" style="color:var(--blue)">0/0</span></div>
    <div id="baseAttrGrid" style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px;"></div>
    <div class="modal-label"><span>é¢å¤–ç‰¹æ®Šè¯æ¡</span></div>
    <div id="specAttrGrid" style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px;"></div>
    <button class="btn-q bg-g" onclick="saveFinal()" style="width:100%; margin-top:20px;">ç¡®è®¤å½•å…¥</button>
</div>

<div class="modal" id="helpModal">
    <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:var(--title-color);">çƒŸé›¨æ±Ÿæ¹–æ‰“é€ åºåˆ—åŠ©æ‰‹</div>
    <div style="font-size:13px; line-height:1.7; color:var(--nav-text);">
        â€¢ <b>å½•å…¥é€»è¾‘</b>ï¼šç‚¹å‡»ä¸Šæ–¹å“è´¨æŒ‰é’®ï¼ˆç»¿/è“/ç´«ï¼‰è®°å½•å½“å‰åºåˆ—ã€‚åŸºç¡€è¯æ¡ä¸Šé™å°†æ ¹æ®å“è´¨è‡ªåŠ¨è®¾ä¸º 1/2/3 ä¸ªã€‚<br>
        â€¢ <b>æ“ä½œåŒºè¯´æ˜</b>ï¼šæ¯ä¸ªæ¡ç›®å³ä¾§è®¾æœ‰åŒåŠŸèƒ½åŒºã€‚å·¦ä¾§ <b>â˜…</b> ç”¨äºæ ‡è®°â€œä¿ç•™â€ï¼Œç‚¹å‡»åæ•´è¡Œé«˜äº®ï¼Œæ–¹ä¾¿å®šä½æå“ä½ç½®ï¼›å³ä¾§ <b>âœ•</b> ç‚¹å‡»åˆ é™¤è®°å½•ã€‚<br>
        â€¢ <b>è¡¨æ ¼å¸ƒå±€</b>ï¼šä¸­é—´åŠ ç²—ç«–çº¿ç”¨äºåŒºåˆ†åŒåœºæ™¯ä¸‹çš„ä¸¤ä»¶ä¸åŒè£…å¤‡åºåˆ—ã€‚<br>
        â€¢ <b>æ•°æ®å®‰å…¨</b>ï¼šæ‰€æœ‰æ•°æ®å‡ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ã€‚<b>æ›´æ¢è®¾å¤‡æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å‰ï¼ŒåŠ¡å¿…ç‚¹å‡»å³ä¸Šè§’ã€å¤‡ä»½ã€‘å¯¼å‡º JSON æ–‡ä»¶ã€‚</b>
    </div>
    <button onclick="closeAllModals()" style="width:100%; padding:10px; margin-top:20px; border-radius:8px; border:1px solid var(--border); cursor:pointer; background:var(--btn-idle); color:var(--text);">æˆ‘çŸ¥é“äº†</button>
</div>

<script>
    const LOC_ICONS = { 'å‰‘ç‹é˜':'âš”ï¸', 'é“¸å‰‘å±±åº„':'ğŸ”¥', 'å¡åŒ—':'â„ï¸', 'æ˜æœˆå³°':'ğŸŒ™' };
    const LOC_SPECIAL_ATTRS = { 'å‰‘ç‹é˜':['å‘½ä¸­+110','æ”»å‡»+50','è‡‚åŠ›+5'], 'é“¸å‰‘å±±åº„':['è‡‚åŠ›+12','æ”»å‡»+69','çœŸå…ƒ+10'], 'å¡åŒ—':['é˜²å¾¡+290','æ°”è¡€+380','å…ä¼¤+1'], 'æ˜æœˆå³°':['èº«æ³•+5','å…ä¼¤+2'] };
    const ATTRS = { weapon_base:['ç©¿ç”²','é€Ÿåº¦','é—ªé¿','æ‹›æ¶','æ°”è¡€','ç ´æ‹›æ¶','ç ´é—ªé¿'], 'æ£':['æº…ä¼¤','é˜²å¾¡'], 'æ‹³å¥—':['å…ä¼¤','é˜²å¾¡'], 'åˆ€':['æ”»å‡»','æ°”è¡€'], 'å‰‘':['æ”»å‡»','æ°”è¡€'], 'ç”²':['å…ä¼¤','åä¼¤','æ”»å‡»','æ°”è¡€','é€Ÿåº¦','é˜²å¾¡','éŸ§æ€§','å‘½ä¸­','é—ªé¿','æ‹›æ¶'], 'è…°å¸¦':['å…ä¼¤','å‘½ä¸­','å›è¡€','æ‹›æ¶','æ”»å‡»','é€Ÿåº¦','é—ªé¿','éŸ§æ€§'], 'æŠ¤è…•':['å…ä¼¤','åä¼¤','å‰‘ä¼¤','åˆ€ä¼¤','æ‹³ä¼¤','æ£ä¼¤','æ°”è¡€','é€Ÿåº¦','æ”»å‡»','é—ªé¿','é˜²å¾¡','éŸ§æ€§','ç ´æ‹›æ¶','ç ´é—ªé¿'], 'é¡¹é“¾':['æ”»å‡»','å…ä¼¤','å‰‘ä¼¤','åˆ€ä¼¤','æ‹³ä¼¤','æ£ä¼¤','æ°”è¡€','å‘½ä¸­','æ‹›æ¶','é—ªé¿','é˜²å¾¡','åä¼¤','éŸ§æ€§','å›è¡€'], 'æˆ’æŒ‡':['æ”»å‡»','å¸è¡€','å‰‘ä¼¤','åˆ€ä¼¤','æ‹³ä¼¤','æ£ä¼¤','æ°”è¡€','å‘½ä¸­','æ‹›æ¶','é€Ÿåº¦','é—ªé¿','é˜²å¾¡','éŸ§æ€§','èšæ°”','ç ´æ‹›æ¶'] };
    const FORGE_CONFIG = { 'æ‹³å¥—':['ç ´å†›æŒ‡å¥—','æ’¼å²³æ‹³å¥—'], 'åˆ€':['æ å½±åˆ€','ç¢æœˆé‡åˆ€'], 'å‰‘':['å·½é£å‰‘','ä¸‡ä»é‡å‰‘'], 'æ£':['ç¢è™šæª','è´ªç‹¼æ£'], 'æˆ’æŒ‡':['é’äº‘æˆ’','è‹å¸ƒå®æˆ’'], 'é¡¹é“¾':['é’äº‘å ','é½æœ¨æ ¼å '] };
    const SEW_CONFIG = { 'ç”²':['å‘¼å¦‚æœ¨ç”²','ä¹Œèš•å®ç”²'], 'æŠ¤è…•':['ç´«è–‡æŠ¤è…•','ä¹Œæ–¯æŠ¤è…•'], 'è…°å¸¦':['ç‰è¡¡æŠ¤è…°','å‰è¾¾æŠ¤è…°'] };
    const LOC_MAP = { 'forge':['å‰‘ç‹é˜', 'é“¸å‰‘å±±åº„'], 'sew':['å¡åŒ—', 'æ˜æœˆå³°'] };

    let curType = 'æ‹³å¥—', curSystem = 'forge', tempEntry = null;

    function init() { if (localStorage.getItem('yanyu_theme') === 'light') toggleTheme(); renderNav(); renderMain(); }
    function toggleTheme() {
        const next = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', next);
        document.getElementById('themeToggle').innerText = next === 'light' ? 'â˜€ï¸ æ¨¡å¼' : 'ğŸŒ™ æ¨¡å¼';
        localStorage.setItem('yanyu_theme', next);
    }
    function renderNav() {
        document.getElementById('forgeNav').innerHTML = '<span class="nav-label">é“¸é€ è£…å¤‡</span>';
        document.getElementById('sewNav').innerHTML = '<span class="nav-label">ç¼çº«é˜²å…·</span>';
        Object.keys(FORGE_CONFIG).forEach(t => createNavBtn(t, 'forge', 'forgeNav'));
        Object.keys(SEW_CONFIG).forEach(t => createNavBtn(t, 'sew', 'sewNav'));
    }
    function createNavBtn(t, sys, id) {
        const b = document.createElement('button'); b.className = `btn-type ${t===curType?'active':''}`;
        b.innerText = t; b.onclick = () => { curType = t; curSystem = sys; renderNav(); renderMain(); };
        document.getElementById(id).appendChild(b);
    }
    function addEntry(loc, idx, q) {
        tempEntry = { loc, equipIdx: idx, q, limit: (q==='green'?1:(q==='blue'?2:3)), baseAttrs: [], specialAttr: "" };
        document.getElementById('mask').style.display = 'block';
        document.getElementById('attrPicker').style.display = 'block';
        renderPicker();
    }
    function renderPicker() {
        const base = document.getElementById('baseAttrGrid'); const spec = document.getElementById('specAttrGrid');
        document.getElementById('limitLabel').innerText = `${tempEntry.baseAttrs.length} / ${tempEntry.limit}`;
        base.innerHTML = ''; spec.innerHTML = '';
        let pool = (curSystem==='sew')?ATTRS[curType]:[...ATTRS.weapon_base, ...(ATTRS[curType]||[])];
        pool.forEach(a => {
            const btn = document.createElement('button'); const isSel = tempEntry.baseAttrs.includes(a);
            btn.style.cssText = `background:var(--btn-idle);padding:10px 2px;font-size:12px;border:1px solid var(--border);border-radius:6px;cursor:pointer;color:${isSel?'white':'var(--blue)'};background:${isSel?'var(--blue)':''};`;
            btn.innerText = a; btn.onclick = () => { if(isSel) tempEntry.baseAttrs = tempEntry.baseAttrs.filter(i=>i!==a); else if(tempEntry.baseAttrs.length < tempEntry.limit) tempEntry.baseAttrs.push(a); renderPicker(); };
            base.appendChild(btn);
        });
        (LOC_SPECIAL_ATTRS[tempEntry.loc] || []).forEach(s => {
            const btn = document.createElement('button'); const isSel = tempEntry.specialAttr === s;
            btn.style.cssText = `background:var(--btn-idle);padding:10px 2px;font-size:12px;border:1px solid var(--border);border-radius:6px;cursor:pointer;color:${isSel?'white':'var(--purple)'};background:${isSel?'var(--purple)':''};`;
            btn.innerText = s; btn.onclick = () => { tempEntry.specialAttr = isSel ? "" : s; renderPicker(); };
            spec.appendChild(btn);
        });
    }
    function saveFinal() {
        const db = JSON.parse(localStorage.getItem('yanyu_v24_db') || '{}');
        const ens = curSystem==='forge'?FORGE_CONFIG[curType]:SEW_CONFIG[curType];
        const en = ens[tempEntry.equipIdx];
        if(!db[curType]) db[curType] = {}; if(!db[curType][tempEntry.loc]) db[curType][tempEntry.loc] = {}; if(!db[curType][tempEntry.loc][en]) db[curType][tempEntry.loc][en] = [];
        let list = db[curType][tempEntry.loc][en]; let p=0; while(list[p]) p++;
        list[p] = { q:tempEntry.q, attrs:tempEntry.baseAttrs, special:tempEntry.specialAttr, k:false };
        localStorage.setItem('yanyu_v24_db', JSON.stringify(db)); renderMain(); closeAllModals();
    }
    function renderMain() {
        const db = JSON.parse(localStorage.getItem('yanyu_v24_db') || '{}'); const grid = document.getElementById('mainGrid');
        const ens = curSystem==='forge'?FORGE_CONFIG[curType]:SEW_CONFIG[curType]; grid.innerHTML = '';
        LOC_MAP[curSystem].forEach(loc => {
            const d = db[curType]?.[loc] || {}; const l1 = d[ens[0]]||[], l2 = d[ens[1]]||[]; const max = Math.max(l1.length, l2.length);
            let h = `<div class="loc-section"><div class="loc-title">${LOC_ICONS[loc]} ${loc}</div><div class="control-head">
                <div class="equip-ctrl"><span class="ename">${ens[0]}</span><div class="btn-group"><button class="btn-q bg-g" onclick="addEntry('${loc}',0,'green')">ç»¿</button><button class="btn-q bg-b" onclick="addEntry('${loc}',0,'blue')">è“</button><button class="btn-q bg-p" onclick="addEntry('${loc}',0,'purple')">ç´«</button></div></div>
                <div class="equip-ctrl"><span class="ename">${ens[1]}</span><div class="btn-group"><button class="btn-q bg-g" onclick="addEntry('${loc}',1,'green')">ç»¿</button><button class="btn-q bg-b" onclick="addEntry('${loc}',1,'blue')">è“</button><button class="btn-q bg-p" onclick="addEntry('${loc}',1,'purple')">ç´«</button></div></div></div>
                <div class="table-wrapper"><table><thead><tr><th class="td-idx">#</th><th>${ens[0]}</th><th class="v-line"></th><th>${ens[1]}</th></tr></thead><tbody>`;
            for(let i=0; i<max; i++) { h += `<tr><td class="td-idx">${i+1}</td>${renderTd(l1[i], ens[0], loc, i)}<td class="v-line"></td>${renderTd(l2[i], ens[1], loc, i)}</tr>`; }
            grid.innerHTML += h + `</tbody></table></div></div>`;
        });
    }
    function renderTd(it, en, loc, i) {
        if(!it) return `<td><div class="cell-container"><div class="data-main" style="color:var(--border)">-</div></div></td>`;
        const attrs = (it.attrs.length||it.special)?(it.attrs.map(a=>`<span class="attr-tag">${a}</span>`).join('')+(it.special?`<span class="special-tag">${it.special}</span>`:'')):'-';
        return `<td class="${it.k?'col-keep':''}">
            <div class="cell-container">
                <div class="data-main"><b style="color:var(--${it.q});font-size:11px">${it.q==='green'?'ç»¿':it.q==='blue'?'è“':'ç´«'}</b><div style="display:flex;flex-wrap:wrap;justify-content:center">${attrs}</div></div>
                <div class="op-right-zone">
                    <div class="op-btn op-keep ${it.k?'active':''}" onclick="toggleStar('${loc}','${en}',${i})">â˜…</div>
                    <div class="op-btn op-del" onclick="delEntry('${loc}','${en}',${i})">âœ•</div>
                </div>
            </div></td>`;
    }
    function showHelp() { document.getElementById('mask').style.display='block'; document.getElementById('helpModal').style.display='block'; }
    function closeAllModals() { document.getElementById('mask').style.display='none'; document.getElementById('helpModal').style.display='none'; document.getElementById('attrPicker').style.display='none'; }
    function toggleStar(loc, en, i) { const db = JSON.parse(localStorage.getItem('yanyu_v24_db')); db[curType][loc][en][i].k = !db[curType][loc][en][i].k; localStorage.setItem('yanyu_v24_db', JSON.stringify(db)); renderMain(); }
    function delEntry(loc, en, i) { if(confirm('åˆ é™¤è®°å½•ï¼Ÿ')) { const db = JSON.parse(localStorage.getItem('yanyu_v24_db')); db[curType][loc][en][i] = null; localStorage.setItem('yanyu_v24_db', JSON.stringify(db)); renderMain(); } }
    function clearCurrent() { if(confirm('æ¸…ç©ºï¼Ÿ')) { const db = JSON.parse(localStorage.getItem('yanyu_v24_db')); delete db[curType]; localStorage.setItem('yanyu_v24_db', JSON.stringify(db)); renderMain(); } }
    function exportData() { const d = localStorage.getItem('yanyu_v24_db'); if(!d) return; const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([d],{type:'application/json'})); a.download='yanyu_backup.json'; a.click(); }
    function importData() { document.getElementById('fileInput').click(); }
    document.getElementById('fileInput').onchange = e => { const r = new FileReader(); r.onload = f => { localStorage.setItem('yanyu_v24_db', f.target.result); location.reload(); }; r.readAsText(e.target.files[0]); };
    init();
</script>
</body>
</html>